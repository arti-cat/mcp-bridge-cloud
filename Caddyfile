# Caddyfile for MCP Bridge Cloud
# Provides wildcard SSL and reverse proxy to tunnel relay service

*.mcp-bridge.xyz {
  # Automatic HTTPS with Let's Encrypt (requires DNS challenge for wildcard)
  tls {
    dns cloudflare {env.CLOUDFLARE_API_TOKEN}
  }

  # Enable logging
  log {
    output file /var/log/caddy/access.log
    format json
  }

  # Reverse proxy to tunnel relay service
  reverse_proxy localhost:8080 {
    # Preserve original headers
    header_up Host {host}
    header_up X-Real-IP {remote_host}
    header_up X-Forwarded-For {remote_host}
    header_up X-Forwarded-Proto {scheme}
  }
}

# Main domain (for landing page / dashboard)
mcp-bridge.xyz {
  tls {
    dns cloudflare {env.CLOUDFLARE_API_TOKEN}
  }

  # Serve static files or proxy to dashboard
  # For now, proxy to dashboard on port 3000
  reverse_proxy localhost:3000
}

# Health check endpoint (direct access, no SSL needed)
:2019 {
  respond /healthz "OK" 200
}
